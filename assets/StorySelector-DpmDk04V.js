import{c as N,r as b,j as e,u as i,C,X as S,s as w,a as _,R as E}from"./index-B6pwUzlO.js";import{c as $,a as F}from"./confetti.module-Dd8cKnWH.js";const M=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],D=N("layout-grid",M);const L=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],P=N("pen-line",L);const I=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],R=N("star",I);const A=[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]],T=N("table-2",A),G=["기","승","전","결"];function V(l,a,n){const o=Math.floor(a/Math.ceil(n/4));let s=[.4,.6,.9,.5][Math.min(o,3)];return l.match(/[!?]{2,}/)&&(s=Math.min(1,s+.2)),l.includes("...")&&(s=Math.max(0,s-.15)),l.includes("ㅠ")&&(s=Math.max(0,s-.2)),s}const H=b.memo(function({dialogs:a}){if(a.length<2)return null;const n=a.map((h,p)=>V(h,p,a.length)),o=80,c=24,s=2,u=n.map((h,p)=>{const r=s+p/(n.length-1)*(o-s*2),d=c-s-h*(c-s*2);return`${r},${d}`}).join(" "),m=n.indexOf(Math.max(...n)),g=s+m/(n.length-1)*(o-s*2),f=c-s-n[m]*(c-s*2);return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("svg",{width:o,height:c,className:"shrink-0",children:[e.jsx("polyline",{points:u,fill:"none",stroke:"url(#curve-gradient)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:g,cy:f,r:"2.5",fill:"var(--color-warning)"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"curve-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--color-primary)"}),e.jsx("stop",{offset:"50%",stopColor:"var(--color-warning)"}),e.jsx("stop",{offset:"100%",stopColor:"var(--color-accent)"})]})})]}),e.jsx("div",{className:"flex gap-0.5 text-[9px] text-muted",children:G.map(h=>e.jsx("span",{children:h},h))})]})});function O({story:l,index:a}){const n=i(r=>r.editedDialogs),o=i(r=>r.setEditedDialogs),[c,s]=b.useState(!1),[u,m]=b.useState([]),g=n[a]??l.dialog,f=r=>{r.stopPropagation(),m([...g]),s(!0)},h=r=>{r.stopPropagation(),o(a,u),s(!1),w("대사가 수정되었어요! 프롬프트에 반영됩니다.","success")},p=r=>{r.stopPropagation(),s(!1)};return c?e.jsxs("div",{className:"mt-2 space-y-1.5",onClick:r=>r.stopPropagation(),children:[u.map((r,d)=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] text-muted w-5 shrink-0",children:d+1}),e.jsx("input",{type:"text",value:r,onChange:j=>{const t=[...u];t[d]=j.target.value,m(t)},className:"flex-1 text-xs px-2 py-1 border border-border rounded-lg bg-white focus:outline-none focus:border-accent dark:bg-card"})]},d)),e.jsxs("div",{className:"flex gap-1.5 mt-1",children:[e.jsxs("button",{type:"button",onClick:h,className:"flex items-center gap-1 px-2.5 py-1 text-xs bg-accent text-white rounded-lg cursor-pointer hover:opacity-90",children:[e.jsx(C,{className:"w-3 h-3"}),"저장"]}),e.jsxs("button",{type:"button",onClick:p,className:"flex items-center gap-1 px-2.5 py-1 text-xs border border-border text-muted rounded-lg cursor-pointer hover:bg-surface",children:[e.jsx(S,{className:"w-3 h-3"}),"취소"]})]})]}):e.jsxs("button",{type:"button",onClick:f,className:"flex items-center gap-1 text-xs text-accent cursor-pointer hover:underline mt-1",children:[e.jsx(P,{className:"w-3 h-3"}),"대사 편집",n[a]&&e.jsx("span",{className:"text-[10px] text-warning",children:"(수정됨)"})]})}const k=[{border:"border-primary",bg:"bg-primary",light:"bg-primary-light/50"},{border:"border-accent",bg:"bg-accent",light:"bg-accent-light/50"},{border:"border-warning",bg:"bg-warning",light:"bg-[#FFF8EC]"}],q=b.memo(function({story:a,index:n,selected:o,onSelect:c,themeName:s,copied:u}){const m=k[n%k.length],g=i(t=>t.favorites),f=i(t=>t.addFavorite),h=i(t=>t.removeFavorite),p=i(t=>t.generatedPrompts),r=g.find(t=>t.story.title===a.title&&t.story.character===a.character),d=!!r,j=t=>{t.stopPropagation(),d&&r?h(r.savedAt):f(a,p[n]??"")};return e.jsxs("div",{role:"button",tabIndex:0,onClick:c,onKeyDown:t=>{t.key==="Enter"&&c()},className:`
        w-full text-left p-4 rounded-2xl cursor-pointer transition-all
        ${o?`border-2 ${m.border} ${m.light} shadow-[0_4px_16px_rgba(0,0,0,0.1)] scale-[1.02]`:"border border-border bg-card hover:shadow-[0_4px_12px_rgba(0,0,0,0.08)] hover:-translate-y-0.5"}
      `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${m.bg} text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold`,children:n+1}),e.jsx("span",{className:"bg-char text-white rounded-full px-2.5 py-0.5 text-sm font-medium",children:a.character}),e.jsx("span",{className:"bg-accent text-white rounded-full px-2.5 py-0.5 text-sm font-medium",children:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"button",tabIndex:0,onClick:j,onKeyDown:t=>{t.key==="Enter"&&j(t)},className:`cursor-pointer transition-transform hover:scale-125 ${d?"text-warning":"text-muted/40 hover:text-warning/60"}`,"aria-label":d?"즐겨찾기 해제":"즐겨찾기 추가",children:e.jsx(R,{className:"w-4 h-4",fill:d?"currentColor":"none"})}),o&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-success",children:[u?e.jsx(C,{className:"w-3.5 h-3.5"}):e.jsx(_,{className:"w-3.5 h-3.5"}),u?"복사됨":"복사하기"]})]})]}),e.jsx("div",{className:"font-bold text-base mb-1",children:a.title}),e.jsx("p",{className:"text-sm text-primary font-medium",children:a.kick}),a.dialog.length>=2&&e.jsx("div",{className:"mt-2",children:e.jsx(H,{dialogs:a.dialog})}),e.jsx(O,{story:a,index:n})]})}),y=b.memo(function(){return e.jsxs("div",{className:"w-full p-4 rounded-2xl border border-border bg-card overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/60 to-transparent dark:via-white/10 animate-[shimmer_1.5s_ease-in-out_infinite] bg-[length:200%_100%]"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("div",{className:"h-6 w-6 bg-border rounded-full"}),e.jsx("div",{className:"h-5 w-14 bg-border rounded-full"}),e.jsx("div",{className:"h-5 w-12 bg-border rounded-full"})]}),e.jsx("div",{className:"h-5 w-3/4 bg-border rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-surface rounded"})]})});function X(){const l=i(t=>t.generatedStories),a=i(t=>t.generatedPrompts),n=i(t=>t.selectedStory),o=i(t=>t.isGeneratingStories),c=i(t=>t.setSelectedStory),s=i(t=>t.getEffectiveTheme),u=i(t=>t.requestRegenerate),m=i(t=>t.hasEverCopied),g=i(t=>t.markCopied),f=s(),[h,p]=b.useState(null),[r,d]=b.useState("card"),j=b.useCallback(async(t,x)=>{c(t);const v=a[x];if(v)try{await $(v),p(x),w(`스토리 ${x+1} 프롬프트가 복사되었어요!`,"success"),m||(F({particleCount:60,spread:50,origin:{y:.7},colors:["#007AFF","#5856D6","#34C759","#FF9500"]}),g()),setTimeout(()=>p(null),2e3)}catch{w("복사에 실패했어요","error")}},[a,c,m,g]);return l.length===0&&!o?null:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx("span",{className:"bg-warning text-white w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold shadow-[0_2px_6px_rgba(255,149,0,0.3)]",children:"4"}),e.jsx("span",{className:"text-lg font-bold text-text",children:"스토리 선택"}),!o&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-muted ml-1",children:"클릭하면 프롬프트가 자동 복사돼요"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 bg-surface rounded-lg p-0.5",children:[e.jsx("button",{type:"button",onClick:()=>d("card"),className:`p-1.5 rounded-md cursor-pointer transition-all ${r==="card"?"bg-card text-text shadow-sm":"text-muted"}`,"aria-label":"카드 보기",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>d("table"),className:`p-1.5 rounded-md cursor-pointer transition-all ${r==="table"?"bg-card text-text shadow-sm":"text-muted"}`,"aria-label":"테이블 보기",children:e.jsx(T,{className:"w-4 h-4"})})]})]})]}),r==="table"&&!o&&l.length>0&&e.jsx("div",{className:"overflow-x-auto mb-3 border border-border rounded-2xl",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-surface text-muted",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"제목"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"캐릭터"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"반전"})]})}),e.jsx("tbody",{children:l.map((t,x)=>{const v=n?.title===t.title&&n?.character===t.character;return e.jsxs("tr",{onClick:()=>j(t,x),className:`cursor-pointer transition-colors border-t border-border ${v?"bg-primary-light":"hover:bg-surface"}`,children:[e.jsx("td",{className:"px-3 py-2.5 font-bold text-primary",children:x+1}),e.jsx("td",{className:"px-3 py-2.5 font-medium",children:t.title}),e.jsx("td",{className:"px-3 py-2.5",children:e.jsx("span",{className:"bg-char text-white rounded-full px-2 py-0.5 text-xs",children:t.character})}),e.jsx("td",{className:"px-3 py-2.5 text-primary text-xs",children:t.kick})]},x)})})]})}),e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-3 gap-3 ${r==="table"&&!o&&l.length>0?"hidden":""}`,role:"radiogroup","aria-label":"스토리 선택",children:o?e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(y,{}),e.jsx(y,{})]}):l.map((t,x)=>e.jsx("div",{className:"animate-[flipIn_0.4s_ease-out_both]",style:{animationDelay:`${x*150}ms`},children:e.jsx(q,{story:t,index:x,selected:n?.title===t.title&&n?.character===t.character,onSelect:()=>j(t,x),themeName:f,copied:h===x})},`${t.title}-${x}`))}),!o&&l.length>0&&e.jsxs("button",{type:"button",onClick:()=>{c(null),p(null),u()},className:"mt-3 flex items-center gap-2 text-sm text-muted border border-border rounded-xl px-4 py-2.5 cursor-pointer hover:bg-surface hover:shadow-sm transition-all w-full justify-center",children:[e.jsx(E,{className:"w-4 h-4"}),"다시 생성"]})]})}export{X as default};
