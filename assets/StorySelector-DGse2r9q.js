import{c as y,r as N,j as e,u as i,C as k,X as E,s as w,a as _,L as $,R as F}from"./index-CrX-ehvV.js";import{c as M,a as P}from"./confetti.module-Dd8cKnWH.js";const D=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],L=y("pen-line",D);const O=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],A=y("shirt",O);const I=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],R=y("star",I);const T=[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]],V=y("table-2",T),G=["기","승","전","결"];function H(l,r,n){const o=Math.floor(r/Math.ceil(n/4));let a=[.4,.6,.9,.5][Math.min(o,3)];return l.match(/[!?]{2,}/)&&(a=Math.min(1,a+.2)),l.includes("...")&&(a=Math.max(0,a-.15)),l.includes("ㅠ")&&(a=Math.max(0,a-.2)),a}const z=N.memo(function({dialogs:r}){if(r.length<2)return null;const n=r.map((x,g)=>H(x,g,r.length)),o=80,d=24,a=2,p=n.map((x,g)=>{const s=a+g/(n.length-1)*(o-a*2),c=d-a-x*(d-a*2);return`${s},${c}`}).join(" "),h=n.indexOf(Math.max(...n)),u=a+h/(n.length-1)*(o-a*2),j=d-a-n[h]*(d-a*2);return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("svg",{width:o,height:d,className:"shrink-0",children:[e.jsx("polyline",{points:p,fill:"none",stroke:"url(#curve-gradient)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:u,cy:j,r:"2.5",fill:"var(--color-warning)"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"curve-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--color-primary)"}),e.jsx("stop",{offset:"50%",stopColor:"var(--color-warning)"}),e.jsx("stop",{offset:"100%",stopColor:"var(--color-accent)"})]})})]}),e.jsx("div",{className:"flex gap-0.5 text-[9px] text-muted",children:G.map(x=>e.jsx("span",{children:x},x))})]})});function q({story:l,index:r}){const n=i(s=>s.editedDialogs),o=i(s=>s.setEditedDialogs),[d,a]=N.useState(!1),[p,h]=N.useState([]),u=n[r]??l.dialog,j=s=>{s.stopPropagation(),h([...u]),a(!0)},x=s=>{s.stopPropagation(),o(r,p),a(!1),w("대사가 수정되었어요! 프롬프트에 반영됩니다.","success")},g=s=>{s.stopPropagation(),a(!1)};return d?e.jsxs("div",{className:"mt-2 space-y-2",onClick:s=>s.stopPropagation(),children:[p.map((s,c)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted w-8 shrink-0",children:["컷",c+1]}),e.jsx("input",{type:"text",value:s,onChange:b=>{const f=[...p];f[c]=b.target.value,h(f)},className:"flex-1 text-sm px-3 py-2 border border-border rounded-xl bg-white focus:outline-none focus:border-accent dark:bg-card"})]},c)),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{type:"button",onClick:x,className:"flex items-center gap-1.5 px-3 py-2 text-sm font-semibold bg-accent text-white rounded-xl cursor-pointer hover:opacity-90",children:[e.jsx(k,{className:"w-4 h-4"}),"저장"]}),e.jsxs("button",{type:"button",onClick:g,className:"flex items-center gap-1.5 px-3 py-2 text-sm border border-border text-muted rounded-xl cursor-pointer hover:bg-surface",children:[e.jsx(E,{className:"w-4 h-4"}),"취소"]})]})]}):e.jsxs("button",{type:"button",onClick:j,className:"flex items-center gap-2 px-3 py-2 text-sm font-semibold text-accent border border-accent/40 bg-accent-light rounded-xl cursor-pointer hover:shadow-sm",children:[e.jsx(L,{className:"w-4 h-4"}),"대사 편집",n[r]&&e.jsx("span",{className:"text-[11px] text-warning",children:"(수정됨)"})]})}function K({story:l,index:r}){const n=i(s=>s.editedOutfits),o=i(s=>s.setEditedOutfits),[d,a]=N.useState(!1),[p,h]=N.useState([]),u=n[r]??Array(l.dialog.length).fill(""),j=s=>{s.stopPropagation(),h([...u]),a(!0)},x=s=>{s.stopPropagation(),o(r,p),a(!1),w("컷별 복장 설정이 저장되었어요! 프롬프트에 반영됩니다.","success")},g=s=>{s.stopPropagation(),a(!1)};return d?e.jsxs("div",{className:"mt-2 space-y-2",onClick:s=>s.stopPropagation(),children:[p.map((s,c)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted w-8 shrink-0",children:["컷",c+1]}),e.jsx("input",{type:"text",value:s,onChange:b=>{const f=[...p];f[c]=b.target.value,h(f)},placeholder:"예: 검정 정장 + loosen tie",className:"flex-1 text-sm px-3 py-2 border border-border rounded-xl bg-white focus:outline-none focus:border-warning dark:bg-card"})]},c)),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs("button",{type:"button",onClick:x,className:"flex items-center gap-1.5 px-3 py-2 text-sm font-semibold bg-warning text-white rounded-xl cursor-pointer hover:opacity-90",children:[e.jsx(k,{className:"w-4 h-4"}),"저장"]}),e.jsxs("button",{type:"button",onClick:g,className:"flex items-center gap-1.5 px-3 py-2 text-sm border border-border text-muted rounded-xl cursor-pointer hover:bg-surface",children:[e.jsx(E,{className:"w-4 h-4"}),"취소"]})]})]}):e.jsxs("button",{type:"button",onClick:j,className:"flex items-center gap-2 px-3 py-2 text-sm font-semibold text-warning border border-warning/40 bg-[#FFF8EC] rounded-xl cursor-pointer hover:shadow-sm",children:[e.jsx(A,{className:"w-4 h-4"}),"복장 편집",n[r]&&e.jsx("span",{className:"text-[11px] text-warning",children:"(수정됨)"})]})}const S=[{border:"border-primary",bg:"bg-primary",light:"bg-primary-light/50"},{border:"border-accent",bg:"bg-accent",light:"bg-accent-light/50"},{border:"border-warning",bg:"bg-warning",light:"bg-[#FFF8EC]"}],X=N.memo(function({story:r,index:n,selected:o,onSelect:d,themeName:a,copied:p,episodeLabel:h}){const u=S[n%S.length],j=i(t=>t.favorites),x=i(t=>t.addFavorite),g=i(t=>t.removeFavorite),s=i(t=>t.generatedPrompts),c=j.find(t=>t.story.title===r.title&&t.story.character===r.character),b=!!c,f=t=>{t.stopPropagation(),b&&c?g(c.savedAt):x(r,s[n]??"")};return e.jsxs("div",{role:"button",tabIndex:0,onClick:d,onKeyDown:t=>{t.key==="Enter"&&d()},className:`
        w-full text-left p-4 rounded-2xl cursor-pointer transition-all
        ${o?`border-2 ${u.border} ${u.light} shadow-[0_4px_16px_rgba(0,0,0,0.1)] scale-[1.02]`:"border border-border bg-card hover:shadow-[0_4px_12px_rgba(0,0,0,0.08)] hover:-translate-y-0.5"}
      `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${u.bg} text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold`,children:n+1}),e.jsx("span",{className:"bg-char text-white rounded-full px-2.5 py-0.5 text-sm font-medium",children:r.character}),e.jsx("span",{className:"bg-accent text-white rounded-full px-2.5 py-0.5 text-sm font-medium",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{role:"button",tabIndex:0,onClick:f,onKeyDown:t=>{t.key==="Enter"&&f(t)},className:`cursor-pointer transition-transform hover:scale-125 ${b?"text-warning":"text-muted/40 hover:text-warning/60"}`,"aria-label":b?"즐겨찾기 해제":"즐겨찾기 추가",children:e.jsx(R,{className:"w-4 h-4",fill:b?"currentColor":"none"})}),o&&e.jsxs("span",{className:"flex items-center gap-1 text-xs font-medium text-success",children:[p?e.jsx(k,{className:"w-3.5 h-3.5"}):e.jsx(_,{className:"w-3.5 h-3.5"}),p?"복사됨":"복사하기"]})]})]}),e.jsxs("div",{className:"font-bold text-base mb-1 flex items-center gap-2",children:[e.jsx("span",{children:r.title}),h&&e.jsx("span",{className:"text-xs font-semibold text-primary bg-primary-light px-2 py-0.5 rounded-full",children:h})]}),e.jsx("p",{className:"text-sm text-primary font-medium",children:r.kick}),r.dialog.length>=2&&e.jsx("div",{className:"mt-2",children:e.jsx(z,{dialogs:r.dialog})}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(q,{story:r,index:n}),e.jsx(K,{story:r,index:n})]})]})}),C=N.memo(function(){return e.jsxs("div",{className:"w-full p-4 rounded-2xl border border-border bg-card overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/60 to-transparent dark:via-white/10 animate-[shimmer_1.5s_ease-in-out_infinite] bg-[length:200%_100%]"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("div",{className:"h-6 w-6 bg-border rounded-full"}),e.jsx("div",{className:"h-5 w-14 bg-border rounded-full"}),e.jsx("div",{className:"h-5 w-12 bg-border rounded-full"})]}),e.jsx("div",{className:"h-5 w-3/4 bg-border rounded mb-2"}),e.jsx("div",{className:"h-4 w-full bg-surface rounded"})]})});function Y(){const l=i(t=>t.generatedStories),r=i(t=>t.generatedPrompts),n=i(t=>t.selectedStory),o=i(t=>t.isGeneratingStories),d=i(t=>t.setSelectedStory),a=i(t=>t.getEffectiveTheme),p=i(t=>t.requestRegenerate),h=i(t=>t.hasEverCopied),u=i(t=>t.markCopied),j=i(t=>t.serialMode),x=a(),[g,s]=N.useState(null),[c,b]=N.useState("card"),f=N.useCallback(async(t,m)=>{d(t);const v=r[m];if(v)try{await M(v),s(m),w(`스토리 ${m+1} 프롬프트가 복사되었어요!`,"success"),h||(P({particleCount:60,spread:50,origin:{y:.7},colors:["#007AFF","#5856D6","#34C759","#FF9500"]}),u()),setTimeout(()=>s(null),2e3)}catch{w("복사에 실패했어요","error")}},[r,d,h,u]);return l.length===0&&!o?null:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2.5 mb-4",children:[e.jsx("span",{className:"bg-warning text-white w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold shadow-[0_2px_6px_rgba(255,149,0,0.3)]",children:"4"}),e.jsx("span",{className:"text-lg font-bold text-text",children:"스토리 선택"}),!o&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-muted ml-1",children:"클릭하면 프롬프트가 자동 복사돼요"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 bg-surface rounded-lg p-0.5",children:[e.jsx("button",{type:"button",onClick:()=>b("card"),className:`p-1.5 rounded-md cursor-pointer transition-all ${c==="card"?"bg-card text-text shadow-sm":"text-muted"}`,"aria-label":"카드 보기",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>b("table"),className:`p-1.5 rounded-md cursor-pointer transition-all ${c==="table"?"bg-card text-text shadow-sm":"text-muted"}`,"aria-label":"테이블 보기",children:e.jsx(V,{className:"w-4 h-4"})})]})]})]}),c==="table"&&!o&&l.length>0&&e.jsx("div",{className:"overflow-x-auto mb-3 border border-border rounded-2xl",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-surface text-muted",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"제목"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"캐릭터"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"주제"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"반전"})]})}),e.jsx("tbody",{children:l.map((t,m)=>{const v=n?.title===t.title&&n?.character===t.character;return e.jsxs("tr",{onClick:()=>f(t,m),className:`cursor-pointer transition-colors border-t border-border ${v?"bg-primary-light":"hover:bg-surface"}`,children:[e.jsx("td",{className:"px-3 py-2.5 font-bold text-primary",children:m+1}),e.jsxs("td",{className:"px-3 py-2.5 font-medium",children:[e.jsx("span",{children:t.title}),j&&e.jsxs("span",{className:"ml-1.5 text-xs text-primary",children:[t.episode??m+1,"화"]})]}),e.jsx("td",{className:"px-3 py-2.5",children:e.jsx("span",{className:"bg-char text-white rounded-full px-2 py-0.5 text-xs",children:t.character})}),e.jsx("td",{className:"px-3 py-2.5",children:e.jsx("span",{className:"bg-accent text-white rounded-full px-2 py-0.5 text-xs",children:t.theme?.trim()||x})}),e.jsx("td",{className:"px-3 py-2.5 text-primary text-xs",children:t.kick})]},m)})})]})}),e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-3 gap-3 ${c==="table"&&!o&&l.length>0?"hidden":""}`,role:"radiogroup","aria-label":"스토리 선택",children:o?e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx(C,{}),e.jsx(C,{})]}):l.map((t,m)=>e.jsx("div",{className:"animate-[flipIn_0.4s_ease-out_both]",style:{animationDelay:`${m*150}ms`},children:e.jsx(X,{story:t,index:m,selected:n?.title===t.title&&n?.character===t.character,onSelect:()=>f(t,m),themeName:t.theme?.trim()||x,copied:g===m,episodeLabel:j?`${t.episode??m+1}화`:void 0})},`${t.title}-${m}`))}),!o&&l.length>0&&e.jsxs("button",{type:"button",onClick:()=>{d(null),s(null),p()},className:"mt-3 flex items-center gap-2 text-sm text-muted border border-border rounded-xl px-4 py-2.5 cursor-pointer hover:bg-surface hover:shadow-sm transition-all w-full justify-center",children:[e.jsx(F,{className:"w-4 h-4"}),"다시 생성"]})]})}export{Y as default};
